<!DOCTYPE html>
<!--[if lt IE 9]><html class="no-js lt-ie9" lang="en"
dir="ltr"><![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="fr" dir="ltr">
<!--<![endif]-->

<head>
    <meta charset="utf-8">
    <title>Manuel de conception de l'Infobase Santé - Canada.ca</title>

    <meta content="width=device-width,initial-scale=1" name="viewport">
    <meta name="description">
    <!--[if gte IE 9 | !IE ]><!-->
    <link href="https://www.canada.ca/etc/designs/canada/wet-boew/assets/favicon.ico" rel="icon" type="image/x-icon">
    <link rel="stylesheet" href="https://www.canada.ca/etc/designs/canada/wet-boew/css/theme.min.css">
    <link rel="stylesheet" href="../../css/toc.css">
    <link rel="stylesheet" href="../../css/in-page.css">
    <link rel="stylesheet" href="../../css/alpha-beta-banner.css" />

    <script src="https://d3js.org/d3.v7.min.js"></script> 
    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js" integrity="sha512-K1qjQ+NcF2TYO/eI3M6v8EiNYZfA95pQumfvcVrTHtwQVDG+aHRqLi/ETn2uB+1JqwYqVG3LIvdm9lj6imS/pQ==" crossorigin="anonymous"></script> 		<!-- makes ToC work -->

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css">
    <!--<![endif]-->
    <!--[if lt IE 9]>
<link href="./GCWeb/assets/favicon.ico" rel="shortcut icon" />
		<link rel="stylesheet" href="./GCWeb/css/ie8-theme.min.css" />
		<script
		src="http://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.
		min.js"></script> <script
		src="./wet-boew/js/ie8-wet-boew.min.js"></script> <![endif]-->
    <!--[if lte IE 9]>
		<![endif]-->
    <noscript>
        <link rel="stylesheet" href="./wet-boew/css/noscript.min.css" />
    </noscript>
</head>

<style>
  .viztype2 {
           display:none; 
  }

  .viztype3 {
           display:none; 
  }

  .viztype4 {
           display:none; 
  }
</style>


<body id="start" class="page-type-nav" vocab="http://schema.org/" typeof="WebPage" data-spy="scroll" data-target="#toc">
  <ul id="wb-tphp">
    <li class="wb-slc">
        <a class="wb-sl" href="#wb-cont">Passer au contenu principal</a>
    </li>
    <li class="wb-slc visible-sm visible-md visible-lg">
        <a class="wb-sl" href="#wb-info">Passer à « Au sujet du gouvernement »</a>
    </li>
</ul>
    <header>
    <div id="wb-bnr" class="container-fluid">
    <section id="wb-lng" class="text-right">
      <h2 class="wb-inv">Sélection de la langue</h2>
      <ul class="list-inline margin-bottom-none">
          <li><a lang="en" href="../../design-system/library/bar-graphs.html">English</a></li>
      </ul>
    </section>
    <div class="row">
    <div class="brand col-xs-5 col-md-4">
      <a href="https://www.canada.ca/fr/index.html"><img src="https://www.canada.ca/etc/designs/canada/wet-boew/assets/sig-blk-fr.svg" alt=""><span class="wb-inv"> Gouvernement du Canada / <span lang="en">Government of Canada</span></span></a>
    </div>

    </div>
    </div>



    </header>
    


<main property="mainContentOfPage" class="wb-prettify all-pre">
<div class="container-fluid" style="padding:0px;">
    	<section class="blue-header well well-sm brdr-0 mrgn-bttm-0 mrgn-tp-0">
<h2 class="mrgn-tp-md"><a class="top-menu" href="../index.html">Manuel de conception de l'Infobase Santé</a></h2>
        		</section>
            <section class="brdr-0">
  <div class="row" style="margin-right:0px">

    <section class="col-sm-12 visible-xs visible-sm">

      <a id="btn-toc" class="btn btn-block btn-primary wb-lbx lbx-modal" title="Example of a modal popup" href="#inline_content_modal" style="color: white !important; border-radius: 0px;"><i class="fas fa-bars"></i>&nbsp Table of contents</a>

      <section id="inline_content_modal" class="mfp-hide modal-dialog modal-content overlay-def">
			<header class="modal-header">
        <h2 class="modal-title">Table des matières</h2>
			</header>
			<div class="modal-body">
        <ul>
          <li > <a href="../commencer.html">Démarrer</a></li>
          <li><a href="../donnees.html">Données</a></li>
              <li><a href="../visualisation.html">Mise en récit et visualisation</a>
               </li>
          <li><a href="../bibliotheque.html">Bibliothèque de composantes</a>
          <ul>
            <li><a href="../bibliotheque/boutons.html">Boutons de personnalisation</a></li>
            <li><a href="../bibliotheque/carte.html">Carte</a></li>
            <li><a href="../bibliotheque/thermique.html">Carte thermique</a></li>
            <li><a href="../bibliotheque/barres.html">Diagramme à barres</a></li>
            <li><a href="../bibliotheque/circulaire.html">Diagrammes circulaires et diagramme en anneau</a></li>
            <li><a href="../bibliotheque/ligne.html">Graphique linéaire</a></li>
            <li><a href="../bibliotheque/histogramme.html">Histogramme</a></li>
            <li><a href="../bibliotheque/cles.html">Indicateurs clés</a></li>
            <li><a href="../bibliotheque/onglets.html">Interface à onglets</a></li>
            <li><a href="../bibliotheque/nuages.html">Nuage de points</a></li>
            <li><a href="../bibliotheque/produits-connexes.html">Produits connexes</a></li>
            <li><a href="../bibliotheque/chrono.html">Sélecteur chronologique</a></li>
            <li><a href="../bibliotheque/deroulant.html">Sélecteur déroulant</a></li>
            <li><a href="../bibliotheque/transitions.html">Transitions</a></li>
          
        </ul>
      
      </li>
          <li><a href="../performance.html">Mesure de la performance et amélioration continue</a>
          </ul>
			</div>
		</section>
    </section>

    <div class="mgrn-tp-xl visible-sm"><p><br></p></div> <!-- temp test fix for menu covering button -->
<div class="col-md-2 global-toc visible-md visible-lg">
  <h2 class="h3 mrgn-lft-md">Table des matières</h2>

  <ul class="menu-list lst-none">

    <li> <a href="../commencer.html">Démarrer</a></li>
    <li><a href="../donnees.html">Données</a></li>
    <li><a href="../visualisation.html">Mise en récit et visualisation</a>
      </li>
    <li><a href="../bibliotheque.html">Bibliothèque de composantes</a>
    
      <ul class="menu-list lst-none">
        <li><a href="../bibliotheque/boutons.html">Boutons de personnalisation</a></li>
        <li><a href="../bibliotheque/carte.html">Carte</a></li>
        <li><a href="../bibliotheque/thermique.html">Carte thermique</a></li>
        <li><a class="active" href="../bibliotheque/barres.html">Diagramme à barres</a></li>
        <li><a href="../bibliotheque/circulaire.html">Diagrammes circulaires et diagramme en anneau</a></li>
        <li><a href="../bibliotheque/ligne.html">Graphique linéaire</a></li>
        <li><a href="../bibliotheque/histogramme.html">Histogramme</a></li>
        <li><a href="../bibliotheque/cles.html">Indicateurs clés</a></li>
        <li><a href="../bibliotheque/onglets.html">Interface à onglets</a></li>
        <li><a href="../bibliotheque/nuages.html">Nuage de points</a></li>
        <li><a href="../bibliotheque/produits-connexes.html">Produits connexes</a></li>
        <li><a href="../bibliotheque/chrono.html">Sélecteur chronologique</a></li>
        <li><a href="../bibliotheque/deroulant.html">Sélecteur déroulant</a></li>
        <li><a href="../bibliotheque/transitions.html">Transitions</a></li>
      </ul>
  
    </li>
    <li><a  href="../performance.html">Mesure de la performance et amélioration continue</a>
      </li>
  
  </ul>
  
</div>


    <div class="col-md-2 visible-md visible-lg">

      <nav id="toc" data-spy="affix" data-toggle="toc" class="affix" >


<h2 class="h3 mrgn-lft-lg">Sur cette page</h2>



<ul class="nav mrgn-lft-lg">
  <li class="longdoc-toc-link"><a href="#quand">Quand utiliser cette composante</a></li>
  <li class="longdoc-toc-link"><a href="#eviter">Quoi éviter</a></li>
  <li class="longdoc-toc-link"><a href="#design">Design et code</a></li>
  <li class="longdoc-toc-link"><a href="#contenu">Lignes directrices sur le contenu</a></li>
  <li class="longdoc-toc-link"><a href="#accessibilite">Lignes directrices sur l'accessibilité</a></li>
  <!--<li class="longdoc-toc-link"><a href="#recherche">Recherche</a></li>-->

</ul>

          </nav>
    </div>

<div class="col-md-7 mrgn-tp-lg" style="padding-left: 40px; padding-right: 40px">

<h1 class="gc-thickline mrgn-tp-0">Diagramme à barres</h1>
<p>Un diagramme à barres est une représentation visuelle de données qui utilise des barres pour montrer les valeurs relatives de différents points de données.</p>

<p>Les diagrammes à barres peuvent être orientés horizontalement ou verticalement.</p>
<div class="visible-xs visible-sm">

<h2 class="h3">Sur cette page</h2>
<ul>
  <li><a href="#quand">Quand utiliser cette composante</a></li>
  <li><a href="#eviter">Quoi éviter</a></li>
  <li><a href="#design">Design et code</a></li>
  <li><a href="#contenu">Lignes directrices sur le contenu</a></li>
  <li><a href="#accessibilite">Lignes directrices sur l'accessibilité</a></li>
  <!--<li><a href="#recherche">Recherche</a></li>-->

</ul>
</div>
<h2 id="quand">Quand utiliser cette composante</h2>
<ul>
  <li>Pour montrer la taille ou la valeur relative de différents points de données</li>
<li>Pour comparer les valeurs de différents points de données</li>
<li>Pour montrer la distribution des données sur une plage de valeurs</li>
</ul>

<div class="well well-sm cnt-wdth-lmtd"">
  <h3 class="mrgn-tp-sm">Exemples</h3>
  <ul>
    <li>Un diagramme à barres comparant les taux de vaccination de différents groupes d'âge dans une population</li>
    <li>Un diagramme à barres montrant le nombre de personnes ayant été dépistées pour une condition de santé spécifique, par sexe</li>
  </ul>
  </div>
  <h3>Quand utiliser un diagramme à barres verticales</h3>
  <ul>
  <li>Vous avez un grand nombre de points de données ou de catégories</li>
  <li>Vous voulez mettre en évidence les valeurs de l'axe Y</li>
  <li>Vous voulez montrer les données de manière compacte et économique en termes d'espace</li>
  </ul>
  <h3>Quand utiliser un diagramme à barres horizontales</h3>
  <ul>
  <li>Vous avez des étiquettes de catégories longues</li>
  <li>Vous voulez mettre en évidence les valeurs de l'axe X</li>
  <li>Vous voulez montrer les données de manière facile à lire et comparable</li>
  </ul>
  <h3>Quand utiliser un diagramme à barres superposées</h3>
  <ul>
    <li>La somme des valeurs des différentes catégories est importante</li>
  <li>Pour montrer à la fois la valeur totale et la distribution des catégories qui composent cette valeur</li>
  </ul>
  <h3>Quand utiliser un diagramme à barres groupées</h3>
  <ul>
    <li>Pour montrer la taille relative de différentes catégories sur le même axe X</li>
  <li>Lorsque la somme des valeurs n'est pas au centre de l'attention</li>
  </ul>

<h2 id="eviter">Quoi éviter</h2>
<ul>
  <li>N'utilisez pas de graphiques à barres pour montrer des données sans valeur numérique claire</li>
  <li>N'utilisez pas de graphiques à barres pour montrer des données ayant des unités ou des échelles différentes</li>
</ul>

<h2 id="design">Design et code</h2>
<fieldset class="gc-chckbxrdio form-inline">
  <legend>Choississez un type:</legend>
  <div class="radio label-inline">
    <input id="graph1" type="radio" name="optradio" value="viztype1">
    <label for="graph1">Barres verticales</label>
  </div>
  <div class="radio label-inline">
    <input id="graph2" type="radio" value="viztype2" name="optradio">
    <label for="graph2">Barres horizontales</label>
  </div>
  <div class="radio label-inline">
    <input id="graph3" type="radio" value="viztype3" name="optradio">
    <label for="graph3">Barres groupées</label>
  </div>
  <div class="radio label-inline">
    <input id="graph4" type="radio" value="viztype4" name="optradio">
    <label for="graph4">Barres superposées</label>
  </div>
</filedset>
<div class="graph viztype1 mrgn-tp-md">
    
    
  <div class="pattern-demo mrgn-bttm-md">
  <h3>Quantité de fruits</h3>
<div id="vertical"></div>
</div>
<details>
  <summary>HTML</summary>
  <button class="btn btn-default" onclick="CopyToClipboard('code1');return false;">Copier dans le presse-papiers</button>
  <pre id="code1"><code>&lt;!-- Ajouter la bibliothèque D3 dans la section head --&gt;
&lt;script src="https://d3js.org/d3.v7.min.js"&gt;&lt;/script&gt;
   
&lt;!-- Ajouter ce div dans la section où vous voulez ajouter le graphique -->

&lt;div id="vertical"&gt;&lt;/div&gt;</code></pre>
</details>
<details>
  <summary>JS</summary>
  <button class="btn btn-default" onclick="CopyToClipboard('code2');return false;">Copier dans le presse-papiers</button>
  <pre id="code2"><code>&lt;script&gt;
    var language = document.documentElement.lang;
    //1. load data
    var csvfiles = ['https://test.canada.ca/phac-aspc/design-system/library/bar-graphs/vertical_data.csv', // 0
    ]
    var promises = [];
    csvfiles.forEach(function(url) {
      promises.push(d3.csv(url))
    });
    //Request + response + and then...
    Promise.all(promises).then(function(datasets) {
      processData(datasets[0]);
    })
    const createGraph = (graphID, svgID, width, height) => conditionalAppend(d3.select(svgID), "svg", `#svg-${graphID}`).attr("preserveAspectRatio", "xMinYMin meet").attr("viewBox", "0 0 " + (width) + " " + (height)).attr("id", `svg-${graphID}`)
    // Append an element if no match is found, otherwise select the existing one
    function conditionalAppend(parent, type, additionalSelector = "") {
      const existing = parent.select(`${type}${additionalSelector}`)
      return !existing.empty() ? existing : parent.append(type);
    }
    // Insert an element if no match is found, otherwise select the existing one
    function conditionalInsert(parent, type, before, additionalSelector = "") {
      const existing = parent.select(`${type}${additionalSelector}`)
      return !existing.empty() ? existing : parent.insert(type, before);
    }
    class Visual {
      constructor(draw) {
        this._draw = draw
      }
      draw(data, ...args) {
        this._draw(data, ...args)
      }
    }
    const palette = {
      Yellow: "#FBDD69",
      Orange: "#FF9258",
      LightBlue: "#93D9FF",
      Teal: "#2C93B4",
      Green: "#00727D"
    }
    //2.
    function processData(data) {
      verticalGraph.draw(data, `#vertical`, 330, 250);
    }
    //4.2
    let verticalGraph = new Visual(function(data, svgID, svgWidth, svgHeight) {
      // 		const formatValueWithUnit = (d) => data[d]
      const dataGrouped = d3.group(data, d => d.fruit);
      const svg = createGraph("vertical", svgID, svgWidth, svgHeight)
      const margin = {
          top: 20,
          right: 20,
          bottom: 90,
          left: 30
        },
        width = svgWidth - (margin.left + margin.right),
        height = svgHeight - (margin.top + margin.bottom),
        g = conditionalAppend(svg, "g").attr("transform", `translate(${margin.left}, ${margin.top})`)
      let domainArr = d3.map(data, d => d.fruit);
      const colour = d3.scaleOrdinal().domain(domainArr).range([palette.Orange, palette.Teal, palette.Yellow, palette.Orange, palette.Teal, palette.Yellow, palette.Orange, palette.Yellow])
      /* SEX GRAPH */
      // axis
      let xArray = {
        "en": ["Apples", "Oranges", "Pears", "Bananas"],
        "fr": ["Pommes", "Oranges", "Poires", "Bananes"]
      };
      let x = d3.scaleBand().domain(domainArr).range([0, width]).padding(0.4);
      const maxY = d3.max(data, function(d) {
        console.log(+d.quantity);
        return +d.quantity;
      });
      let y = d3.scaleLinear().domain([0, maxY + 1]).range([height, 0]);
      let axis = conditionalAppend(g, "g", ".axis").classed("axis", true)
      let x_axis = conditionalAppend(axis, "g", ".x_axis").classed("x_axis", true)
      x_axis.attr("transform", "translate(0," + (height) + ")").call(d3.axisBottom(x)).selectAll("text")
        // .attr("transform", "rotate(-35)")
        .classed("x_axisText", true).attr("font-size", "0.9rem")
        // .style("text-anchor", "end")
        .text(function(d, i) {
          return xArray[language][i];
        })
      // 			.call(wrapHori,75);
      let y_axis = conditionalAppend(axis, "g", ".y_axis").classed("y_axis", true)
      y_axis.attr("id", "y_axis").attr("transform", "translate(0,0)").call(d3.axisLeft(y).ticks(5).tickFormat(function(d) {
        return d;
      })).selectAll("text").attr("class", "axisText").attr("font-size", "0.9rem")
      svg.append("text").attr("class", "x-axis-text").text(function(d, i) {
        if (language == "en") {
          return 'Fruits';
        } else {
          return 'Fruits';
        }
      }).attr("x", width / 1.6).attr("y", height + 65).attr("font-size", "1.2rem")
      // 			.call(wrap, 350)
      // bars
      let rectGroup = conditionalAppend(g, "g", "#mainChartAreaGender").attr("id", "mainChartAreaGender").selectAll("g").data(domainArr).join("g").attr("id", d => d.replace(/\s/g, ''))
      const rects = rectGroup.selectAll("rect").data(d => [d]).join("rect").attr("fill", "#008080") //d => colour(d))
        .attr("x", d => x(d)).attr("width", x.bandwidth()).each(function(d) {
          conditionalAppend(d3.select(this), "title").text(d)
        }).transition().duration(1000).attr("height", d => y(0) - y(dataGrouped.get(d)[0].quantity)).attr("y", d => y(dataGrouped.get(d)[0].quantity))
      rectGroup.selectAll("text").data(d => [d]).join("text").style("text-anchor", "middle").classed("rectText", true).attr("font-size", "1rem").attr("font-weight", "bold").attr("x", d => x(d) + x.bandwidth() / 2).transition().duration(1000).attr("y", d => y(dataGrouped.get(d)[0].quantity) - 5).tween("text", function(d) {
        let item = d3.select(this);
        if (item.property("previousValue") === undefined) item.property("previousValue", dataGrouped.get(d)[0].quantity);
        let i = d3.interpolateNumber(item.property("previousValue"), dataGrouped.get(d)[0].quantity);
        if (dataGrouped.get(d)[0].quantity === "" || dataGrouped.get(d)[0].quantity === 0) {
          item.text("N/A");
          item.property("previousValue", 0);
        } else {
          item.property("previousValue", dataGrouped.get(d)[0].quantity);
          return function(t) {
            return item.text(d3.format(".0f")(i(t)));
          };
        }
      }).on("end", () => {
        // d3.selectAll(".rectText").call(wrap,100);
      })
    })
&lt;/script&gt;</code></pre>
</details>
</div>

<div class="graph viztype2 mrgn-tp-md">
<div class="pattern-demo mrgn-bttm-md">

  <h3>Quantité de fruits</h3>
  <div id="horizontal"></div>
</div>
<details>
  <summary>HTML</summary>
  <button class="btn btn-default" onclick="CopyToClipboard('code1');return false;">Copier dans le presse-papiers</button>
  <pre id="code1"><code>&lt;!-- Ajouter la bibliothèque D3 dans la section head --&gt;
&lt;script src="https://d3js.org/d3.v7.min.js"&gt;&lt;/script&gt;
   
&lt;!-- Ajouter ce div dans la section où vous voulez ajouter le graphique -->

&lt;div id="horizontal"&gt;&lt;/div&gt;</code></pre>
</details>
<details>
  <summary>JS</summary>
  <button class="btn btn-default" onclick="CopyToClipboard('code2');return false;">Copier dans le presse-papiers</button>
  <pre id="code2"><code>&lt;script&gt;
    var languageHori = document.documentElement.lang;
  
  //1. load data
  var csvfilesHori = [
    'https://test.canada.ca/phac-aspc/design-system/library/bar-graphs/vertical_data.csv', // 0
  ]
  var promisesHori = [];
  csvfilesHori.forEach(function(url) {
    promisesHori.push(d3.csv(url))
  });
  
  //Request + response + and then...
  Promise.all(promisesHori)
  .then(function(datasets) {
    processDataHori(datasets[0]);
  })

  const createGraphHori = (graphID, svgID, width, height) => conditionalAppendHori(d3.select(svgID), "svg", `#svg-${graphID}`)
    .attr("preserveAspectRatio", "xMinYMin meet")
    .attr("viewBox", "0 0 " + (width) + " " + (height))
    .attr("id", `svg-${graphID}`)
  
  // Append an element if no match is found, otherwise select the existing one
  function conditionalAppendHori(parent, type, additionalSelector = "") {
    const existing = parent.select(`${type}${additionalSelector}`)
  
    return !existing.empty() ? existing : parent.append(type);
  }
  // Insert an element if no match is found, otherwise select the existing one
  function conditionalInsertHori(parent, type, before, additionalSelector = "") {
    const existing = parent.select(`${type}${additionalSelector}`)
    return !existing.empty() ? existing : parent.insert(type, before);
  }
  
  class VisualHori {
    constructor(draw) {
      this._draw = draw
    }
  
    draw(data, ...args) {
      this._draw(data, ...args)
    }
  }
  
  const paletteHori = {
    Yellow: "#FBDD69",
    Orange: "#FF9258",
    LightBlue: "#93D9FF",
    Teal: "#2C93B4",
    Green: "#00727D"
  }
  
  //2.
  function processDataHori(data){
      horizontalGraph.draw(data, `#horizontal`, 430, 250);
  }


  //4.2
  let horizontalGraph = new VisualHori(
    function(data, svgID, svgWidth, svgHeight) {
      
  // 		const formatValueWithUnit = (d) => data[d]
          const dataGrouped = d3.group(data, d => d.fruit);
  
      const svg = createGraphHori("horiical", svgID, svgWidth, svgHeight)
  
      const margin = { top: 20, right: 20, bottom: 70, left: 110 },
        width = svgWidth - (margin.left + margin.right),
        height = svgHeight - (margin.top + margin.bottom),
        gHori = conditionalAppendHori(svg, "g").attr("transform", `translate(${margin.left}, ${margin.top})`)
      
      let domainArr = d3.map(data, d => d.fruit);
      const colour = d3.scaleOrdinal().domain(domainArr).range([palette.Orange, palette.Teal, palette.Yellow, palette.Orange, palette.Teal, palette.Yellow, palette.Orange, palette.Yellow])
  
      /* SEX GRAPH */
      let xArray = {"en":	["Apples", "Oranges", "Pears", "Bananas"], "fr": ["Pommes", "Oranges", "Poires", "Bananes"]};
      let x = d3.scaleBand().domain(domainArr).range([0, height]).padding(0.4);
      
      const maxY = d3.max(data, function(d) { console.log(+d.quantity); return +d.quantity;} );
      let y = d3.scaleLinear().domain([0, maxY + 1]).range([0,height]);
  
      let axisHori = conditionalAppendHori(gHori, "g", ".axisHori")
        .classed("axisHori", true)
  
      let x_axisHori = conditionalAppendHori(axisHori, "g", ".x_axisHori")
        .classed("x_axisHori", true)
  
      x_axisHori
        .attr("transform", "translate(0,0)")
        .call(d3.axisLeft(x))
        .selectAll("text")
        // .attr("transform", "rotate(-35)")
        .classed("x_axisText", true)
        .attr("font-size", "0.9rem")
        // .style("text-anchor", "end")
        .text(function(d,i){
          return xArray[language][i];
        })
  // 			.call(wrapHori,75);
        
      let y_axisHori = conditionalAppendHori(axisHori, "g", ".y_axisHori")
        .classed("y_axisHori", true)	
        
      y_axisHori
        .attr("id", "y_axisHori")
        .attr("transform", "translate(0," + (height) + ")")
        .call(d3.axisBottom(y).ticks(5).tickFormat(function(d) {
          return d;
        }))
        .selectAll("text")
        .attr("class", "axisTextHori")
        .attr("font-size", "0.9rem")
  
      svg.append("text")
        .attr("class", "y-axis-text-hori")
        .text(function(d,i){
            if(language == "en"){
                return 'Quantity';
            }else{
                return 'Quantité';
            }
        })
        .attr("x", 10)
  // 			.attr("y", height/3)
        .attr("font-size", "1.2rem")
        .attr("transform", "translate(" + (width / 2) + "," + ((height + margin.top ) + (margin.bottom / 1.5)) +")")
  // 			.call(wrap, 350)	
  
      svg.append("text")
        .attr("class", "x-axis-text-hori")
        .text(function(d,i){
            if(language == "en"){
                return 'Fruits';
            }else{
                return 'Fruits';
            }
        })
        .attr("transform", "translate(20,"+(height/1.1)+")rotate(-90)")
        .attr("x", 10)
        .attr("y", 10)
        .attr("font-size", "1.2rem")
  // 			.call(wrap, 350)
  
      // bars
      let rectGroup = conditionalAppendHori(gHori, "g", "#mainChartAreaHori")
        .attr("id", "mainChartAreaHori")
        .selectAll("g")
        .data(domainArr)
        .join("g")
        .attr("id", d => d.replace(/\s/g, ''))
  
      const rects = rectGroup.selectAll("rect")
        .data(d => [d])
        .join("rect")
        .attr("fill", "#008080") //d => colour(d))
        .attr("y", d => x(d))
        .attr("height", x.bandwidth())
        .each(function(d) {
          conditionalAppendHori(d3.select(this), "title")
            .text(d)
        })
        .transition().duration(1000)
        .attr("x", d => y(0.05))
        .attr("width", d => y(dataGrouped.get(d)[0].quantity))
  
      rectGroup.selectAll("text")
        .data(d => [d])
        .join("text")
        .style("text-anchor", "middle")
        .classed("rectTextHori", true)
        .attr("font-size", "1rem")
        .attr("font-weight", "bold")
        .attr("y", d => x(d) + x.bandwidth() / 1.5)
        .transition().duration(1000)
        .attr("x", d => y(dataGrouped.get(d)[0].quantity) + 15)
        .tween("text", function(d) {
          let item = d3.select(this);
          if (item.property("previousValue") === undefined)
            item.property("previousValue", dataGrouped.get(d)[0].quantity);
          let i = d3.interpolateNumber(item.property("previousValue"), dataGrouped.get(d)[0].quantity);
          if (dataGrouped.get(d)[0].quantity === "" || dataGrouped.get(d)[0].quantity === 0) {
            item.text("N/A");
            item.property("previousValue", 0);
          }
          else {
            item.property("previousValue", dataGrouped.get(d)[0].quantity);
            return function(t) { return item.text(d3.format(".1f")(i(t))); };
          }
        })
        .on("end",()=>{
          // d3.selectAll(".rectText").call(wrap,100);
        })
    }
  )
&lt;/script&gt;</code></pre>
</details>
</div>

 
    <div class="graph viztype3 mrgn-tp-md">
      <div class="pattern-demo mrgn-bttm-md">
      
      <div id="grouped"></div>
    
      <details>
        <summary>HTML</summary>
        <button class="btn btn-default" onclick="CopyToClipboard('code1');return false;">Copier dans le presse-papiers</button>
        <pre id="code1"><code>&lt;!-- Ajouter la bibliothèque D3 dans la section head --&gt;
&lt;script src="https://d3js.org/d3.v7.min.js"&gt;&lt;/script&gt;
    
&lt;!-- Ajouter ce div dans la section où vous voulez ajouter le graphique -->

&lt;div id="grouped"&gt;&lt;/div&gt;</code></pre>
      </details>
      <details>
        <summary>JS</summary>
        <button class="btn btn-default" onclick="CopyToClipboard('code2');return false;">Copier dans le presse-papiers</button>
        <pre id="code2"><code>&lt;script&gt;
      // set the dimensions and margins of the graph
var margin = {top: 10, right: 30, bottom: 20, left: 50},
  width = 460 - margin.left - margin.right,
  height = 400 - margin.top - margin.bottom;

// append the svg object to the body of the page
var svg = d3.select("#grouped")
.append("svg")
  .attr("width", width + margin.left + margin.right)
  .attr("height", height + margin.top + margin.bottom)
.append("g")
  .attr("transform",
        "translate(" + margin.left + "," + margin.top + ")");

var csvfilesGrouped = [
    'https://test.canada.ca/phac-aspc/design-system/library/bar-graphs/grouped-data.csv', // 0
  ]
  var promisesGrouped = [];
  csvfilesGrouped.forEach(function(url) {
    promisesGrouped.push(d3.csv(url))
  });
  
  //Request + response + and then...
  Promise.all(promisesGrouped)
  .then(function(datasets) {
    drawGraph(datasets[0]);
  })

// Parse the Data
function drawGraph(data) {

// List of subgroups = header of the csv files = soil condition here
var subgroups = data.columns.slice(1)

// List of groups = species here = value of the first column called group -> I show them on the X axis
var groups = d3.map(data, function(d){return(d.group)})

console.log(d3.map(data, function(d){return(d.group)}))
// Add X axis
var x = d3.scaleBand()
    .domain(groups)
    .range([0, width])
    .padding([0.2])
svg.append("g")
  .attr("transform", "translate(0," + height + ")")
  .call(d3.axisBottom(x).tickSize(0));

// Add Y axis
var y = d3.scaleLinear()
  .domain([0, 40])
  .range([ height, 0 ]);
svg.append("g")
  .call(d3.axisLeft(y));

// Another scale for subgroup position?
var xSubgroup = d3.scaleBand()
  .domain(subgroups)
  .range([0, x.bandwidth()])
  .padding([0.05])

// color palette = one color per subgroup
var color = d3.scaleOrdinal()
  .domain(subgroups)
  .range(['#e41a1c','#377eb8','#4daf4a'])

// Show the bars
svg.append("g")
  .selectAll("g")
  // Enter in data = loop group per group
  .data(data)
  .enter()
  .append("g")
    .attr("transform", function(d) { return "translate(" + x(d.group) + ",0)"; })
  .selectAll("rect")
  .data(function(d) { return subgroups.map(function(key) { return {key: key, value: d[key]}; }); })
  .enter().append("rect")
    .attr("x", function(d) { return xSubgroup(d.key); })
    .attr("y", function(d) { return y(d.value); })
    .attr("width", xSubgroup.bandwidth())
    .attr("height", function(d) { return height - y(d.value); })
    .attr("fill", function(d) { return color(d.key); });

}
      &lt;/script&gt;</code></pre>
      </details>
      </div>
  </div>

  <div class="graph viztype4 mrgn-tp-md">
    <div class="pattern-demo mrgn-bttm-md">
    
    <p>À venir</p>
    </div>
    </div>
<p><a href="https://d3-graph-gallery.com/barplot.html"><span class="fa fa-arrow-right"></span> Documentation D3.js complète pour les diagrammes à barres</a></p>


<h2 id="contenu">Lignes directrices sur le contenu et le design</h2>
<ul>
  <li>Commencez toujours l'axe Y à 0</li>
  <li>Considérez la possibilité d'ordonner les barres en fonction de la valeur</li>
  <li>Utilisez la couleur judicieusement - en général, utiliser la même couleur pour toutes les barres et utiliser une autre couleur pour mettre en évidence une barre spécifique</li>
  <li>Considérez la possibilité d'inscrire la valeur directement à l'intérieur des barres</li>
  <li>Concevez les barres de manière à ce qu'elles soient plus larges que l'espace entre les barres</li>

  <li>Suivez les <a href="../visualisation/visualisation/design.html">lignes directrices générales sur le contenu</a> </li>
</ul>

<h2 id="accessibilite">Lignes directrices sur l'accessibilité</h2>
<ul>
  <li>Fournissez un tableau de données avec le graphique</li>
  <li>Si le graphique à barres raconte une histoire claire, incluez cette histoire dans le texte alternatif - par exemple, si le graphique montre qu'une catégorie a une valeur beaucoup plus élevée que les autres, préciser cela dans le texte alternatif</li>
  
  
  
  <li>Suivez les <a href="../visualisation/visualisation/design.html#accessibilite">lignes directrices générales sur l'accessibilité</a> </li>
</ul>

<!--<h2 id="recerche">Recherche</h2>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. In lorem dolor, feugiat eu placerat vitae, laoreet a elit. Ut eleifend nec elit quis elementum. Mauris dignissim nunc quam, sed mattis risus fringilla id. Integer luctus, mi vitae efficitur elementum, enim ex scelerisque mi, id venenatis elit justo sit amet dolor. Suspendisse ornare pulvinar maximus. Aenean ac mi ullamcorper purus dictum tincidunt porta a sem. Donec a purus vel ex congue commodo. Integer lacinia neque eget metus tempor maximus. Nunc rhoncus, lacus porttitor sodales tristique, nulla ipsum tempor tellus, vel vestibulum ligula sem nec elit. Etiam consequat hendrerit tincidunt. Sed et tellus hendrerit, blandit mauris quis, blandit velit. Vestibulum volutpat, lectus at ullamcorper egestas, est lacus auctor libero, in sagittis sem massa in eros. Fusce vestibulum, purus in lacinia semper, dolor velit venenatis ex, eget placerat nisl eros vel est. Quisque nulla velit, vehicula eu tempor vitae, faucibus feugiat velit. Suspendisse lectus augue, laoreet vitae enim ac, congue pretium lorem.

</p> -->


    <div class="clearfix"></div>
    	<div class="row pagedetails">




    		<div class="datemod col-xs-12 mrgn-tp-lg">
    				<dl id="wb-dtmd">
    		<dt>Date modified:</dt>
    		<dd><time property="dateModified">2022-10-28</time></dd>
    	</dl>
    		</div>

    	</div>
    		</main>

      </section>





</div>


    		<footer id="wb-info">
        <h2 class="wb-inv">À propos de ce site</h2>
      <div class="gc-contextual">
          <div class="container">
            <nav>
              <h3>Infobase Santé</h3>
              <ul class="list-col-xs-1 list-col-sm-2 list-col-md-3">
                  <li><a href="mailto:infobase@phac-aspc.gc.ca">Communiquer avec nous par courriel</a></li>
              </ul>
            </nav>
          </div>
        </div>
      
        <div class="gc-main-footer">
          <div class="container">
            <nav>
              <h3>Gouvernement du Canada</h3>
              <ul class="list-col-xs-1 list-col-sm-2 list-col-md-3"><li><a href="https://www.canada.ca/fr/contact.html">Toutes les coordonnées</a></li>
                <li><a href="https://www.canada.ca/fr/gouvernement/min.html">Ministères et organismes</a></li>
                <li><a href="https://www.canada.ca/fr/gouvernement/systeme.html">À propos du gouvernement</a></li></ul>
              <h4><span class="wb-inv">Thèmes et sujets</span></h4>
              <ul class="list-unstyled colcount-sm-2 colcount-md-3"><li><a href="https://www.canada.ca/fr/services/emplois.html">Emplois</a></li>
                <li><a href="https://www.canada.ca/fr/services/immigration-citoyennete.html">Immigration et citoyenneté</a></li>
                <li><a href="https://voyage.gc.ca/">Voyage et tourisme</a></li>
                <li><a href="https://www.canada.ca/fr/services/entreprises.html">Entreprises</a></li>
                <li><a href="https://www.canada.ca/fr/services/prestations.html">Prestations</a></li>
                <li><a href="https://www.canada.ca/fr/services/sante.html">Santé</a></li>
                <li><a href="https://www.canada.ca/fr/services/impots.html">Impôts</a></li>
                <li><a href="https://www.canada.ca/fr/services/environnement.html">Environnement et ressources naturelles</a></li>
                <li><a href="https://www.canada.ca/fr/services/defense.html">Sécurité nationale et défense</a></li>
                <li><a href="https://www.canada.ca/fr/services/culture.html">Culture, histoire et sport</a></li>
                <li><a href="https://www.canada.ca/fr/services/police.html">Services de police, justice et urgences</a></li>
                <li><a href="https://www.canada.ca/fr/services/transport.html">Transport et infrastructure</a></li>
                <li><a href="https://www.international.gc.ca/world-monde/index.aspx?lang=fra">Le Canada et le monde</a></li>
                <li><a href="https://www.canada.ca/fr/services/finance.html">Argent et finance</a></li>
                <li><a href="https://www.canada.ca/fr/services/science.html">Science et innovation</a></li>
                <li><a href="https://www.canada.ca/fr/services/autochtones.html">Autochtones</a></li>
                <li><a href="https://www.canada.ca/fr/services/veterans.html">Vétérans et militaires</a></li>
                <li><a href="https://www.canada.ca/fr/services/jeunesse.html">Jeunesse</a></li></ul>
            </nav>
          </div>
        </div>
      
        <div class="gc-sub-footer">
          <div class="container d-flex align-items-center">
            <nav>
              <h3 class="wb-inv">Organisation du gouvernement du Canada</h3>
              <ul>
                <li><a href="https://www.canada.ca/fr/sociaux.html">Médias sociaux</a></li>
                <li><a href="https://www.canada.ca/fr/mobile.html">Applications mobiles</a></li>
                <li><a href="https://www.canada.ca/fr/gouvernement/a-propos.html">À propos de Canada.ca</a></li><li><a href="https://www.canada.ca/fr/transparence/avis.html">Avis</a></li>
                <li><a href="https://www.canada.ca/fr/transparence/confidentialite.html">Confidentialité</a></li></ul>
            </nav>
            <div class="wtrmrk align-self-end">
              <img src="https://wet-boew.github.io/themes-dist/GCWeb/GCWeb/assets/wmms-blk.svg" alt="Symbole du gouvernement du Canada" />
            </div>
          </div>
        </div>
      </footer>
    	<!--[if gte IE 9 | !IE ]><!-->
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.js"></script>
      <script src="https://www.canada.ca/etc/designs/canada/wet-boew/js/wet-boew.min.js"></script>
      <script src="../../js/toc-custom.js"></script>
      <script src="../../js/alpha-banner-fr.js"></script>

      <!--<![endif]-->
      <!--[if lt IE 9]>
          <script src="./wet-boew/js/ie8-wet-boew2.min.js"></script>

          <![endif]-->
          <script src="https://www.canada.ca/etc/designs/canada/wet-boew/js/theme.min.js"></script>

      



<script>

  var language = document.documentElement.lang;
  
  //1. load data
  var csvfiles = [
    'https://test.canada.ca/phac-aspc/design-system/library/bar-graphs/vertical_data.csv', // 0
  ]
  var promises = [];
  csvfiles.forEach(function(url) {
    promises.push(d3.csv(url))
  });
  
  //Request + response + and then...
  Promise.all(promises)
  .then(function(datasets) {
    processData(datasets[0]);
  })

  const createGraph = (graphID, svgID, width, height) => conditionalAppend(d3.select(svgID), "svg", `#svg-${graphID}`)
    .attr("preserveAspectRatio", "xMinYMin meet")
    .attr("viewBox", "0 0 " + (width) + " " + (height))
    .attr("id", `svg-${graphID}`)
  
  // Append an element if no match is found, otherwise select the existing one
  function conditionalAppend(parent, type, additionalSelector = "") {
    const existing = parent.select(`${type}${additionalSelector}`)
  
    return !existing.empty() ? existing : parent.append(type);
  }
  // Insert an element if no match is found, otherwise select the existing one
  function conditionalInsert(parent, type, before, additionalSelector = "") {
    const existing = parent.select(`${type}${additionalSelector}`)
    return !existing.empty() ? existing : parent.insert(type, before);
  }
  
  class Visual {
    constructor(draw) {
      this._draw = draw
    }
  
    draw(data, ...args) {
      this._draw(data, ...args)
    }
  }
  
  const palette = {
    Yellow: "#FBDD69",
    Orange: "#FF9258",
    LightBlue: "#93D9FF",
    Teal: "#2C93B4",
    Green: "#00727D"
  }
  
  //2.
  function processData(data){
      verticalGraph.draw(data, `#vertical`, 330, 250);
  }


  //4.2
  let verticalGraph = new Visual(
    function(data, svgID, svgWidth, svgHeight) {
      
  // 		const formatValueWithUnit = (d) => data[d]
          const dataGrouped = d3.group(data, d => d.fruit);
  
      const svg = createGraph("vertical", svgID, svgWidth, svgHeight)
  
      const margin = { top: 20, right: 20, bottom: 90, left: 30 },
        width = svgWidth - (margin.left + margin.right),
        height = svgHeight - (margin.top + margin.bottom),
        g = conditionalAppend(svg, "g").attr("transform", `translate(${margin.left}, ${margin.top})`)
      
      let domainArr = d3.map(data, d => d.fruit);
      const colour = d3.scaleOrdinal().domain(domainArr).range([palette.Orange, palette.Teal, palette.Yellow, palette.Orange, palette.Teal, palette.Yellow, palette.Orange, palette.Yellow])
  
      /* SEX GRAPH */
      // axis
      let xArray = {"en":	["Apples", "Oranges", "Pears", "Bananas"], "fr": ["Pommes", "Oranges", "Poires", "Bananes"]};
      let x = d3.scaleBand().domain(domainArr).range([0, width]).padding(0.4);
      
      const maxY = d3.max(data, function(d) { console.log(+d.quantity); return +d.quantity;} );
      let y = d3.scaleLinear().domain([0, maxY + 1]).range([height, 0]);
  
      let axis = conditionalAppend(g, "g", ".axis")
        .classed("axis", true)
  
      let x_axis = conditionalAppend(axis, "g", ".x_axis")
        .classed("x_axis", true)
  
      x_axis
        .attr("transform", "translate(0," + (height) + ")")
        .call(d3.axisBottom(x))
        .selectAll("text")
        // .attr("transform", "rotate(-35)")
        .classed("x_axisText", true)
        .attr("font-size", "0.9rem")
        // .style("text-anchor", "end")
        .text(function(d,i){
          return xArray[language][i];
        })
  // 			.call(wrapHori,75);
        
      let y_axis = conditionalAppend(axis, "g", ".y_axis")
        .classed("y_axis", true)	
        
      y_axis
        .attr("id", "y_axis")
        .attr("transform", "translate(0,0)")
        .call(d3.axisLeft(y).ticks(5).tickFormat(function(d) {
          return d;
        }))
        .selectAll("text")
        .attr("class", "axisText")
        .attr("font-size", "0.9rem")
  
  
      svg.append("text")
        .attr("class", "x-axis-text")
        .text(function(d,i){
            if(language == "en"){
                return 'Fruits';
            }else{
                return 'Fruits';
            }
        })
        .attr("x", width / 1.6)
        .attr("y", height + 65)
        .attr("font-size", "1.2rem")
  // 			.call(wrap, 350)
  
      // bars
      let rectGroup = conditionalAppend(g, "g", "#mainChartAreaGender")
        .attr("id", "mainChartAreaGender")
        .selectAll("g")
        .data(domainArr)
        .join("g")
        .attr("id", d => d.replace(/\s/g, ''))
  
      const rects = rectGroup.selectAll("rect")
        .data(d => [d])
        .join("rect")
        .attr("fill", "#008080") //d => colour(d))
        .attr("x", d => x(d))
        .attr("width", x.bandwidth())
        .each(function(d) {
          conditionalAppend(d3.select(this), "title")
            .text(d)
        })
        .transition().duration(1000)
        .attr("height", d => y(0) - y(dataGrouped.get(d)[0].quantity))
        .attr("y", d => y(dataGrouped.get(d)[0].quantity))
  
      rectGroup.selectAll("text")
        .data(d => [d])
        .join("text")
        .style("text-anchor", "middle")
        .classed("rectText", true)
        .attr("font-size", "1rem")
        .attr("font-weight", "bold")
        .attr("x", d => x(d) + x.bandwidth() / 2)
        .transition().duration(1000)
        .attr("y", d => y(dataGrouped.get(d)[0].quantity) - 5)
        .tween("text", function(d) {
          let item = d3.select(this);
          if (item.property("previousValue") === undefined)
            item.property("previousValue", dataGrouped.get(d)[0].quantity);
          let i = d3.interpolateNumber(item.property("previousValue"), dataGrouped.get(d)[0].quantity);
          if (dataGrouped.get(d)[0].quantity === "" || dataGrouped.get(d)[0].quantity === 0) {
            item.text("N/A");
            item.property("previousValue", 0);
          }
          else {
            item.property("previousValue", dataGrouped.get(d)[0].quantity);
            return function(t) { return item.text(d3.format(".0f")(i(t))); };
          }
        })
        .on("end",()=>{
          // d3.selectAll(".rectText").call(wrap,100);
        })
    }
  )
</script>
<script>

  $(document).ready(function(){
      $('input[type="radio"]').click(function(){
          var inputValue = $(this).attr("value");
          var targetBox = $("." + inputValue);
          $(".graph").not(targetBox).hide();
          $(targetBox).show();
      });
  });
  </script>
  
  <script>
  document.getElementById('graph1').click();
  </script>

      <script>
        function CopyToClipboard(id)
        {
        var r = document.createRange();
        r.selectNode(document.getElementById(id));
        window.getSelection().removeAllRanges();
        window.getSelection().addRange(r);
        document.execCommand('copy');
        window.getSelection().removeAllRanges();
        }
        </script>

<script>

  var languageHori = document.documentElement.lang;
  
  //1. load data
  var csvfilesHori = [
    'https://test.canada.ca/phac-aspc/design-system/library/bar-graphs/vertical_data.csv', // 0
  ]
  var promisesHori = [];
  csvfilesHori.forEach(function(url) {
    promisesHori.push(d3.csv(url))
  });
  
  //Request + response + and then...
  Promise.all(promisesHori)
  .then(function(datasets) {
    processDataHori(datasets[0]);
  })

  const createGraphHori = (graphID, svgID, width, height) => conditionalAppendHori(d3.select(svgID), "svg", `#svg-${graphID}`)
    .attr("preserveAspectRatio", "xMinYMin meet")
    .attr("viewBox", "0 0 " + (width) + " " + (height))
    .attr("id", `svg-${graphID}`)
  
  // Append an element if no match is found, otherwise select the existing one
  function conditionalAppendHori(parent, type, additionalSelector = "") {
    const existing = parent.select(`${type}${additionalSelector}`)
  
    return !existing.empty() ? existing : parent.append(type);
  }
  // Insert an element if no match is found, otherwise select the existing one
  function conditionalInsertHori(parent, type, before, additionalSelector = "") {
    const existing = parent.select(`${type}${additionalSelector}`)
    return !existing.empty() ? existing : parent.insert(type, before);
  }
  
  class VisualHori {
    constructor(draw) {
      this._draw = draw
    }
  
    draw(data, ...args) {
      this._draw(data, ...args)
    }
  }
  
  const paletteHori = {
    Yellow: "#FBDD69",
    Orange: "#FF9258",
    LightBlue: "#93D9FF",
    Teal: "#2C93B4",
    Green: "#00727D"
  }
  
  //2.
  function processDataHori(data){
      horizontalGraph.draw(data, `#horizontal`, 430, 250);
  }


  //4.2
  let horizontalGraph = new VisualHori(
    function(data, svgID, svgWidth, svgHeight) {
      
  // 		const formatValueWithUnit = (d) => data[d]
          const dataGrouped = d3.group(data, d => d.fruit);
  
      const svg = createGraphHori("horiical", svgID, svgWidth, svgHeight)
  
      const margin = { top: 20, right: 20, bottom: 70, left: 110 },
        width = svgWidth - (margin.left + margin.right),
        height = svgHeight - (margin.top + margin.bottom),
        gHori = conditionalAppendHori(svg, "g").attr("transform", `translate(${margin.left}, ${margin.top})`)
      
      let domainArr = d3.map(data, d => d.fruit);
      const colour = d3.scaleOrdinal().domain(domainArr).range([palette.Orange, palette.Teal, palette.Yellow, palette.Orange, palette.Teal, palette.Yellow, palette.Orange, palette.Yellow])
  
      /* SEX GRAPH */
      let xArray = {"en":	["Apples", "Oranges", "Pears", "Bananas"], "fr": ["Pommes", "Oranges", "Poires", "Bananes"]};
      let x = d3.scaleBand().domain(domainArr).range([0, height]).padding(0.4);
      
      const maxY = d3.max(data, function(d) { console.log(+d.quantity); return +d.quantity;} );
      let y = d3.scaleLinear().domain([0, maxY + 1]).range([0,height]);
  
      let axisHori = conditionalAppendHori(gHori, "g", ".axisHori")
        .classed("axisHori", true)
  
      let x_axisHori = conditionalAppendHori(axisHori, "g", ".x_axisHori")
        .classed("x_axisHori", true)
  
      x_axisHori
        .attr("transform", "translate(0,0)")
        .call(d3.axisLeft(x))
        .selectAll("text")
        // .attr("transform", "rotate(-35)")
        .classed("x_axisText", true)
        .attr("font-size", "0.9rem")
        // .style("text-anchor", "end")
        .text(function(d,i){
          return xArray[language][i];
        })
  // 			.call(wrapHori,75);
        
      let y_axisHori = conditionalAppendHori(axisHori, "g", ".y_axisHori")
        .classed("y_axisHori", true)	
        
      y_axisHori
        .attr("id", "y_axisHori")
        .attr("transform", "translate(0," + (height) + ")")
        .call(d3.axisBottom(y).ticks(5).tickFormat(function(d) {
          return d;
        }))
        .selectAll("text")
        .attr("class", "axisTextHori")
        .attr("font-size", "0.9rem")
  
      svg.append("text")
        .attr("class", "y-axis-text-hori")
        .text(function(d,i){
            if(language == "en"){
                return 'Quantity';
            }else{
                return 'Quantité';
            }
        })
        .attr("x", 10)
  // 			.attr("y", height/3)
        .attr("font-size", "1.2rem")
        .attr("transform", "translate(" + (width / 2) + "," + ((height + margin.top ) + (margin.bottom / 1.5)) +")")
  // 			.call(wrap, 350)	
  
      svg.append("text")
        .attr("class", "x-axis-text-hori")
        .text(function(d,i){
            if(language == "en"){
                return 'Fruits';
            }else{
                return 'Fruits';
            }
        })
        .attr("transform", "translate(20,"+(height/1.1)+")rotate(-90)")
        .attr("x", 10)
        .attr("y", 10)
        .attr("font-size", "1.2rem")
  // 			.call(wrap, 350)
  
      // bars
      let rectGroup = conditionalAppendHori(gHori, "g", "#mainChartAreaHori")
        .attr("id", "mainChartAreaHori")
        .selectAll("g")
        .data(domainArr)
        .join("g")
        .attr("id", d => d.replace(/\s/g, ''))
  
      const rects = rectGroup.selectAll("rect")
        .data(d => [d])
        .join("rect")
        .attr("fill", "#008080") //d => colour(d))
        .attr("y", d => x(d))
        .attr("height", x.bandwidth())
        .each(function(d) {
          conditionalAppendHori(d3.select(this), "title")
            .text(d)
        })
        .transition().duration(1000)
        .attr("x", d => y(0.05))
        .attr("width", d => y(dataGrouped.get(d)[0].quantity))
  
      rectGroup.selectAll("text")
        .data(d => [d])
        .join("text")
        .style("text-anchor", "middle")
        .classed("rectTextHori", true)
        .attr("font-size", "1rem")
        .attr("font-weight", "bold")
        .attr("y", d => x(d) + x.bandwidth() / 1.5)
        .transition().duration(1000)
        .attr("x", d => y(dataGrouped.get(d)[0].quantity) + 15)
        .tween("text", function(d) {
          let item = d3.select(this);
          if (item.property("previousValue") === undefined)
            item.property("previousValue", dataGrouped.get(d)[0].quantity);
          let i = d3.interpolateNumber(item.property("previousValue"), dataGrouped.get(d)[0].quantity);
          if (dataGrouped.get(d)[0].quantity === "" || dataGrouped.get(d)[0].quantity === 0) {
            item.text("N/A");
            item.property("previousValue", 0);
          }
          else {
            item.property("previousValue", dataGrouped.get(d)[0].quantity);
            return function(t) { return item.text(d3.format(".1f")(i(t))); };
          }
        })
        .on("end",()=>{
          // d3.selectAll(".rectText").call(wrap,100);
        })
    }
  )
</script>

<script type="text/javascript">
  // set the dimensions and margins of the graph
var margin = {top: 10, right: 30, bottom: 20, left: 50},
  width = 460 - margin.left - margin.right,
  height = 400 - margin.top - margin.bottom;

// append the svg object to the body of the page
var svg = d3.select("#grouped")
.append("svg")
  .attr("width", width + margin.left + margin.right)
  .attr("height", height + margin.top + margin.bottom)
.append("g")
  .attr("transform",
        "translate(" + margin.left + "," + margin.top + ")");

var csvfilesGrouped = [
    'https://test.canada.ca/phac-aspc/design-system/library/bar-graphs/grouped-data.csv', // 0
  ]
  var promisesGrouped = [];
  csvfilesGrouped.forEach(function(url) {
    promisesGrouped.push(d3.csv(url))
  });
  
  //Request + response + and then...
  Promise.all(promisesGrouped)
  .then(function(datasets) {
    drawGraph(datasets[0]);
  })

// Parse the Data
function drawGraph(data) {

// List of subgroups = header of the csv files = soil condition here
var subgroups = data.columns.slice(1)

// List of groups = species here = value of the first column called group -> I show them on the X axis
var groups = d3.map(data, function(d){return(d.group)})

console.log(d3.map(data, function(d){return(d.group)}))
// Add X axis
var x = d3.scaleBand()
    .domain(groups)
    .range([0, width])
    .padding([0.2])
svg.append("g")
  .attr("transform", "translate(0," + height + ")")
  .call(d3.axisBottom(x).tickSize(0));

// Add Y axis
var y = d3.scaleLinear()
  .domain([0, 40])
  .range([ height, 0 ]);
svg.append("g")
  .call(d3.axisLeft(y));

// Another scale for subgroup position?
var xSubgroup = d3.scaleBand()
  .domain(subgroups)
  .range([0, x.bandwidth()])
  .padding([0.05])

// color palette = one color per subgroup
var color = d3.scaleOrdinal()
  .domain(subgroups)
  .range(['#e41a1c','#377eb8','#4daf4a'])

// Show the bars
svg.append("g")
  .selectAll("g")
  // Enter in data = loop group per group
  .data(data)
  .enter()
  .append("g")
    .attr("transform", function(d) { return "translate(" + x(d.group) + ",0)"; })
  .selectAll("rect")
  .data(function(d) { return subgroups.map(function(key) { return {key: key, value: d[key]}; }); })
  .enter().append("rect")
    .attr("x", function(d) { return xSubgroup(d.key); })
    .attr("y", function(d) { return y(d.value); })
    .attr("width", xSubgroup.bandwidth())
    .attr("height", function(d) { return height - y(d.value); })
    .attr("fill", function(d) { return color(d.key); });

}

</script>
  </body>
</html>



